# 08 排序

- 默认情况下，结果集会按照相关性进行排序 -- 相关性越高，排名越靠前
- 为多值字段排序
- 相关性评分  _score
- 相似度算法被定义为 TF/IDF


## 排序方式

为了使结果可以按照相关性进行排序，我们需要一个相关性的值。在ElasticSearch的查询结果中， 相关性分值会用 _score 字段来给出一个浮点型的数值，所以默认情况下，结果集 以 _score 进行倒序排列。

## sort 排序

```json
GET /_search
{
    "query": {
        "filtered": {
            "filter": {
                "term": {
                    "user_id": 1
                }
            }
        }
    },
    "sort": {
        "date": {
            "order": "desc"
        }
    }
}
```

## 为多值字段排序

对于数字和日期，你可以从多个值中取出一个来进行排序，你可以使用 min , max , avg 或 sum 这些模式。 比说你可以在 dates 字段中用最早的日期来进行排序：
```
"sort": {
    "dates": {
        "order": "asc",
        "mode": "min"
    }
}
```

ElasticSearch的相似度算法被定义为 TF/IDF，即检索词频率/反向文档频率，包括一下内容：

- 检索词频率:: 检索词在该字段出现的频率？出现频率越高，相关性也越高。 字段中出现过5次要比只出现过 1次的相关性高。
- 反向文档频率:: 每个检索词在索引中出现的频率？频率越高，相关性越低。 检索词出现在多数文档中会比出 现在少数文档中的权重更低， 即检验一个检索词在文档中的普遍重要性。 
- 字段长度准则:: 字段的长度是多少？长度越长，相关性越低。 

检索词出现在一个短的 title 要比同样的词 出现在一个长的 content 字段。 
单个查询可以使用TF/IDF评分标准或其他方式，比如短语查询中检索词的距离或模糊查询里 的检索词相似度。 

相关性并不只是全文本检索的专利。也适用于 yes|no 的子句，匹配的子句越多，相关性评分越高。

如果多条查询子句被合并为一条复合查询语句，比如 bool 查询，则每个查询子句计算得出的评分会被合并到总的相关性评分中。