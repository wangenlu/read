# 第三章 类与对象

- OOP-Klass 模型
- OOP: ordinary object pointer， 或OOPS.即普通对象指针， 用来描述对象实例信息。
- Klass: Java 类的C++对等体，用来描述Java类.
- mark word
- oopsHierarchy.hpp
- Klass数据结构定义了所有Klass 类型共享的结构和行为:描述类型自身的布局，以及刻画出与其他类间的关系(父类、子类、兄弟类等)
- instanceKlass JVM层表示Java对象
- Java itables Java vtables
- OOP-map
- HSDB
- 加载，连接，初始化
- Classfile
- ClassFileParser 类 ParseClassFile()函数
- 符号引用
- 符号->直接引用
- TLABS

## OOP Klass

对于OOPS对象来说，主要职能在于表示对象的实例数据，没必要持有任何虚函数;而在描述Java类的Klass对象中含有VTBL (继承自Klass父类Klass_vtbl)， 那么，Klass就能够根据Java对象的实际类型进行C++的分发(dispatch)，这样一来，OOPS对象只需要通过相应的Klass便可以找到所有的虚函数。这就避免了在每个对象中都分配一个C++ VTBL指针。

Klass向JVM提供两个功能:
- 实现语言层面的 Java 类;
- 实现 Java 对象的分发功能。

上述两个功能在一个C++类中皆能实现。前者在基类Klass中已经实现，而后者是由Klass.子类(见图3-5)提供虚函数实现。

## 常量池

常量池中持有Class文件中引用的所有字符串常量、类名、接口名、字段名、方法名和其他字符信息。当我们仔细观察虚拟机指令时，会发现指令是围绕符号引用设计的，而不
是直接引用。换句话说，指令的执行没有依赖与类、接口、实例或数组的运行时信息，而仅仅是引用了常量池表中的符号信息。不久后我们将看到关于符号引用和直接引用这一话题的内容。

##  加载

初始化类加载器 加载 链接

如果仅从文件的视角考察Java程序，那我们所看到的编译结果便是一堆Class文件。显然，
将这些孤立文件串联在一-起，形成-一个整体，才能称之为-一个程序。联系Class文件的秘诀在
于符号引用。事实上，Class 文件之间正是通过符号引用建立了密切的关系。在程序运行初期，
类加载器将用到的各个类或接口加载进来，然后通过动态链接将它们联接在一起。这样，当程
序运行时，便可以实现类型的相互引用和方法调用。
符号引用是以字符串的形式存在的。在每个Class文件中，都有一个常量池，用来存放该
类中用到的符号引用。当完成加载以后，来自于Class文件的常量池则会在JVM内部关联上一
个位于运行时内存中的常量池数据结构，即运行时常量池。运行时常量池有别于Class文件中
的静态常量池。

如果仅仅是符号，那么引用将失去实际意义。只有当符号引用被转换成直接引用，才能帮
助运行时准确定位内存实体。符号引用转换成直接引用的过程，称为`解析`。因为符号引用来自
于常量池，所以这个过程也被称为常量池解析。解析是链接的核心环节。

# 链接

- 验证
- 准备
- 解析