# Traceroute程序

- TTL
- Traceroute
- I P路由
- IP源站选路选项

> 特点

Traceroute程序使用ICMP报文和IP首部中的TTL字段（生存周期）。TTL字段是由发送端
初始设置一个8bit字段。推荐的初始值由分配数字RFC指定，当前值为64。较老版本的系统
经常初始化为15或32。我们从第7章中的一些ping程序例子中可以看出，发送ICMP回显应答
时经常把TTL设为最大值255。
每个处理数据报的路由器都需要把TTL的值减1或减去数据报在路由器中停留的秒数。由
于大多数的路由器转发数据报的时延都小于1秒钟，因此TTL最终成为一个跳站的计数器，所
经过的每个路由器都将其值减1。

> 作用

Traceroute程序可以让我们看到IP数据报从一台主机传到另一台主机所经过的路由。
Traceroute程序还可以让我们使用IP源路由选项。

> 实现思路

我们现在可以猜想一下Traceroute程序的操作过程。它发送一份TTL字段为1的IP数据报给
目的主机。处理这份数据报的第一个路由器将TTL值减1，丢弃该数据报，并发回一份超时
ICMP报文。这样就得到了该路径中的第一个路由器的地址。然后Traceroute程序发送一份
TTL值为2的数据报，这样我们就可以得到第二个路由器的地址。继续这个过程直至该数据报
到达目的主机。

TTL字段的目的是防止数据报在选路时无休止地在网络中流动。例如，当路由器瘫痪或
者两个路由器之间的连接丢失时，选路协议有时会去检测丢失的路由并一直进行下去。在这
段时间内，数据报可能在循环回路被终止。TTL字段就是在这些循环传递的数据报上加上一
个生存上限。
