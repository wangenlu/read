# 链路层

核心：理解`链路层`的封装。看懂图 2-1 即可(以太网和 IEEE802 封装)。了解`环回接口`的设计技巧

在 TCP/IP 协议族中，链路层主要有三个目的：

1. 为 IP 模块发送和接收 IP 数据报
2. 为 ARP 模块发送 ARP 请求和接收 ARP 应答
3. 为 RARP 发送 RARP 请求和接收 RARP 应答

TCP/IP 支持多种不同的链路层协议，这取决于网络所使用的硬件，如`以太网`、令牌环网、FDDI（光纤分布式数据接口）及 RS-232 串行线路等。

> 了解的名词

- RFC 894
- 以太网和 IEEE802 封装
- SLIP 封装
- CSLIP 封装
- PPP 协议
- 环回接口 Loopback Interface
- 最大传输单元 MTU
- 路径 MTU

## 硬件地址

两种帧格式都采用 48bit（6 字节）的目的地址和源地址（802.3 允许使用 16bit 的地址，但一般是 48bit 地址）。
这就是我们在本书中所称的硬件地址。ARP 和 RARP 协议对 32bit 的 IP 地址和 48bit 的硬件地址进行映射。

[ARP](./chapter-04.md)和[RARP](./chapter-05.md)是链路层的协议，`ARP` 通过 IP 找`硬件地址`，`RARP` 通过`硬件地址`找 IP

## 以太网封装

> 图 2-1 IEEE 802.2/802.3（RFC 1042）和以太网的封装格式（RFC 894）

![TCP-IP-2-1.png](./images/TCP-IP-2-1.svg)

两种帧格式都采用 48bit（6 字节）的`目的地址`和`源地址`（802.3 允许使用 16bit 的地址，但一般是 48bit 地址）。
这就是我所称的`硬件地址`。ARP 和 RARP 协议对 32bit 的 IP 地址和 48bit 的硬件地址进行映射。

> 从上面的图中可知，ARP 和 RARP 协议都是被`包`在以太网协议中，没有 IP 层（网络层）的概念。这也是第[16 章](chapter-16.md)中的 BOOTP 解决的问题。

## MTU 最大传输单元

如果 IP 层有一个数据报要传，而且数据的长度比链路层的 MTU 还大，那么 IP 层就需要进行分片（fragmentation），
把数据报分成若干片，这样每一片都小于 MTU。

## 路径 MT

当在同一个网络上的两台主机互相进行通信时，该网络的 MTU 是非常重要的。但是如果
两台主机之间的通信要通过多个网络，那么每个网络的链路层就可能有不同的 MTU。重要的
不是两台主机所在网络的 MTU 的值，重要的是两台通信主机路径中的最小 MTU。它被称作路径 MTU。
RFC 1191 描述了路径 MTU 的发现机制

路径 MTU 的不同导致，A->B,B->A 走路的路也不同，也能导致两次报文从 A->B 的报文，先发的不一定先到 B。

## 环回接口

理解`环回接口`的`设计技巧`

> 图 2-4 环回接口处理 IP 数据报的过程

![TCP-IP-2-4.png](./images/TCP-IP-2-4.svg)

图中需要指出的关键点是：

1. 传给环回地址（一般是 127.0.0.1）的任何数据均作为 IP 输入。
2. 传给广播地址或多播地址的数据报复制一份传给环回接口，然后送到以太网上。这是因为广播传送和多播传送的定义（第 12 章）包含主机本身。
3. 任何传给该主机 IP 地址的数据均送到环回接口。

看上去用传输层和 IP 层的方法来处理环回数据似乎效率不高，但它简化了设计，因为环回接口可以被看作是网络层下面的另一个链路层。
网络层把一份数据报传送给环回接口，就像传给其他链路层一样，只不过环回接口把它返回到 IP 的输入队列中。
