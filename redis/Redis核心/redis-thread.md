# Redis 线程模型

- Redis 处理网络 IO的线程
- Redis 处理键值对存取的 线程
- Redis 持久化线程
- Redis 同步线程
- Redis 异步删除线程
- 单线程的问题，复杂的操作可能导致线程阻塞，性能下降
- IO单线程的多路复用机制
- 单线程可以避免上下文切换和锁的开销，避免多线程的共享资源竞争
- 多线程编程模式面临的共享资源的并发访问控制问题
- 单线程高性能的原因：内存操作，高效的数据结构（跳表），多路复用机制

## Tips

- Redis 的网络 IO 和键值对读写是由主线程完成的。那么，如果在主线程上执行的操作消耗的时间太长，就会引起主线程阻塞。
- 客户端：网络 IO，键值对增删改查操作，数据库操作；
- 磁盘：生成 RDB 快照，记录 AOF 日志，AOF 日志重写；
- 主从节点：主库生成、传输 RDB 文件，从库接收 RDB 文件、清空数据库、加载 RDB 文件；
- 切片集群实例：向其他实例传输哈希槽信息，数据迁移。

## 阻塞

四个角度：客户端、磁盘、主从库实例、切片集群实例

> 下面的操作会导致`阻塞`

- 集合全量查询和聚合操作
- bigkey 删除
- 清空数据库
- AOF 日志同步写
- FLUSHDB 和 FLUSHALL 操作
- 从库加载 RDB 文件

```redis
UNLINK 异步删除key (DEL 同步删除key)
FLUSHDB ASYNC
FLUSHALL AYSNC
```